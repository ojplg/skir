<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>First Web Socket Try</title>
</head>
<body>



<p>Hello Louisa!!!</p>

<p><div id="crumbs">Default</div></p>

<p><embed class="emb" id="world_map_svg" src="standard_map.svg" type="image/svg+xml" height="519.06781" width="749.81909"/></p>

<script type="text/javascript">

    var connection = new WebSocket('ws://localhost:8080');
    //        connection.onopen = function () {
    //            connection.send('Ping'); // Send the message 'Ping' to the server
    //        };

    window.addEventListener("load", findSVGElements, false);

    var map_svg_document;

    // Log errors
    connection.onerror = function (error) {
        console.log('WebSocket Error ' + error);
    };

    // Log messages from the server
    connection.onmessage = function (e) {
        console.log('Server: ' + e.data);
        document.getElementById("crumbs").innerHTML= e.data;
        set_country_count(e.data, "22");
    };

    function blobClicked(blobName){
        connection.send(blobName);
    };

    function set_country_count(country, count){
        console.log('setting country count for ' + country + " to " + count);
        var element_name = country + "_count";
        console.log('searching for element named ' + element_name)
        var country_count = map_svg_document.getElementById(element_name);
        console.log('got country count as ' + country_count);
        var tspan_attr = country_count.firstChild;
        console.log('got attribute ' + tspan_attr);
        var value_attr = tspan_attr.firstChild;
        console.log('got value attribute ' + value_attr);
        value_attr.data = count;
    }

//    function get_map_svg(){
//        console.log('trying to get the map');
//        var map_svg = document.getElementById('world_map_svg');
//        console.log('got the map_svg variable' + map_svg);
//        map_svg_document = map_svg.getSVGDocument();
//        console.log('set the document to ' + map_svg_document);
//    }

    // fetches the document for the given embedding_element
    function getSubDocument(embedding_element)
    {
        if (embedding_element.contentDocument)
        {
            return embedding_element.contentDocument;
        }
        else
        {
            var subdoc = null;
            try {
                subdoc = embedding_element.getSVGDocument();
            } catch(e) {}
            return subdoc;
        }
    }

    function findSVGElements()
    {
        var elms = document.querySelectorAll(".emb");
        for (var i = 0; i < elms.length; i++)
        {
            var subdoc = getSubDocument(elms[i])
            if (subdoc)
                map_svg_document = subdoc;
        }
    }

</script>



</body>

</html>