<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Canvas Map</title>
</head>
<body>
    <p>Risk.</p>
    <canvas id="canvas_map" width="1000" height="600" onclick="map_clicked">
    </canvas>
</body>

<script>
  var irktusk = new_country('Irktusk', 780, 50, 100, 100, '#3ca824', 'white');
  var japan = new_country('Japan',920,150,45,125, '#2aab0e', 'white');
  var kamchatka = new_country('Kamchatka', 880,100,35,150, 'green', 'white');
  var mongolia = new_country('Mongolia',820,255,85,50,'green', 'white');

  var alaska = new_country('Alaska', 20, 20, 80, 80, '#ddcc00','black');
  var northwest_territory = new_country('Northwest Territory', 100, 20, 80, 80, '#DAEA39','black');
  var greenland = new_country('Greenland', 180, 20, 80, 80, '#CCD666','black');
  var alberta = new_country('Alberta', 80, 100, 60, 60, '#E4F251','black');
  var ontario = new_country('Ontario', 140, 100, 60, 60, '#F2F251','black');
  var quebec = new_country('Quebec', 200, 100, 60, 60, '#EAEA10','black');
  var western_united_states = new_country('Western United States', 100, 160, 80, 80, '#DCDC05','black');
  var eastern_united_states = new_country('Eastern United States', 180, 160, 80, 80, '#DFDF5F','black');
  var central_america = new_country('Central America', 120, 240, 80, 80, 'yellow','black');

  var countries = [ alaska, northwest_territory, alberta, quebec, ontario, eastern_united_states,
                       western_united_states, greenland, central_america,
                     irktusk, japan, kamchatka, mongolia ];



  function draw_map(){
    var canvas = document.getElementById ('canvas_map');
    var context = canvas.getContext ('2d');
    context.fillStyle = 'blue';
    context.fillRect(0,0,1000,600);

    for(var idx=0; idx<countries.length; idx++){
      var country = countries[idx];
      console.log('drawing ' + country.name);
      draw_country(context,country);
    }

    canvas.addEventListener('click', function(e) {
      map_clicked(e);
    });
  }

  function draw_country(context,country){
    context.fillStyle = country.color;
    context.fillRect(country.left, country.top, country.width, country.height);
    context.fillStyle = country.text_color;
    context.font = '10pt Arial';
    var words = country.name.split(' ');
    for(var idx=0; idx<words.length; idx++){
      var word = words[idx];
      var downoffset = 20 + 20 * idx;
      context.fillText(word,country.left + 5, country.top + downoffset);
    }
  }

  function new_country(name, left, top, width, height, color, text_color){
    var that = {};
    that.name = name;
    that.top = top;
    that.left = left;
    that.height = height;
    that.width = width;
    that.color = color;
    that.text_color = text_color;
    return that;
  }

  function map_clicked(e){
    //console.log('Map was clicked: ' + e.offsetX + '/' + e.offsetY);
    //console.log('search ' + countries.length + 'countries');
    for(var idx=0; idx<countries.length; idx++){
      var country = countries[idx];
      //console.log('checking ' + country.name);
      if(country.top <= e.offsetY &&
           country.left <= e.offsetX &&
           country.top + country.height >= e.offsetY &&
           country.left + country.width >= e.offsetX ){
           console.log('Clicked on ' + country.name);
           connection.send('{\'country\':\'' + country.name + '\'}');
      } else {
        //console.log('no country');
      }
    }
  }

  var connection = new WebSocket('ws://localhost:8080');

  draw_map();

</script>

</html>